const post = `
6 Ramadhaan 1440
12 May 2019
Sunday 
Awwal Times

Sehri Ends 5:12
Fajr 5:17
Sunrise 6:36
Ishraaq 6:51
Zawal 12:04 (Zuhr, 5 minutes after Zawaal)
Asr Shafi 3:10
Asr Hanafi 3:55 
Maghrib 5:34
Esha 6:50

_Jamaat Times for various Masaajid_

*1.Masjid AbuBakr Siddique*
Fajr 5:30
Zuhr 12:45 
Asr 5:00
Esha 7:15

*2.Masjid Al Noor(CIS)*
Fajr 5:35
Zuhr 12:45
Asr 4:30
Esha 7:30

*3.Al Asr*
Fajr 5:35
Zuhr 12:45
Asr 4:45
Esha 7:15

*4.Masjid Ansaar (whiteblocks)*
Fajr 5:35
Zuhr 12:45
Asr 4:30
Esha 7:00

*5.Bengal Street Musallah - Moti Khana (372 Bengal Street)*
Fajr 5:35
Zuhr 12:45 
Asr 4:45 
Esha 7:15

*6.Masjid Bilal RA*
Fajr 5:35
Zuhr 12:30 
Asr 4:15
Esha 7:15

*7.Brooklyn Musallah 125 Lange str*
Fajr 5:40
Zohr 1:15 
Asr 4:30
Esha 7:30

*8.Centurion Masjid(186 Leonie Street)*
Fajr 6:00
Zuhr 12:45
Asr 4:45
Esha 7:15

*9.Eldoraigne Musallah*
Fajr 5:35
Zuhr 12:45
Asr 4:45
Esha 7:15

*10.Faizane Syeda Fatima 540 Luttig Street Pta West*
Fajr 5:40
Zuhr 12:45
Asr 4:45
Esha 7:15

*11.Faizan e Medina 338 5th Ave Laudium*
Fajr 5:35
Zuhr 12:45
Asr 4:45
Esha 7:15

*12.Faizane Jeelani Cnr Willem botha &* *gannet crescent, Weirdapark*
Fajr 5:40
Zuhr 12:45
Asr 4:45
Esha 7:15

*13.Faizane Medina Musallah 859 Van Der Hof Str Hercules*
Fajr 5:40
Zohr 1:00
Asr 4:45
Esha 7:15

*14.Faizane e Mushtaaq 199 Koester Street*
Fajr 5:40
Zohr 1:15
Asr 4:45
Esha 7:15

*15.Faizan e RAZA 230 Arend Street Kwaggasrand*
Fajr 5:40
Zuhr 12:45
Asr 4:45
Esha 7:15

*16.Gerhardsville Musallah*
Fajr 5:30
Zuhr 1:00
Asr 4:30
Esha 7:15

*17.Masjid Ghause Azam Darul Uloom Pretoria*
Fajr 5:35
Zuhr 12:45
Asr 4:30 
Esha 7:10

*18.Ghausia Masjid*
Fajr 5:40
Zuhr 12:45
Asr 4:15
Esha 7:15

*19.Masjid Hamza RA*
Fajr 5:35
Zuhr 12:45
Asr 4:45
Esha 7:15

*20.Heuweloord Jamaat Khana*
*Springbark Avenue*
Fajr 5:30 
Zohr 12:45
Asr 4:15
Esha 7:15

*21.Jummah Masjid*
Fajr 5:45 
Zuhr 1:00 
Asr 4:30
Esha 7:30

*22.Madina Musallah Eldo Meadows*
Fajr 5:40
Zuhr 12:45
Asr 4:45
Esha 7:15

*23.Madina Musallah, Menlyn Mall*
Zuhr 1:00
Asr 4:30 
Esha 7:10

*24.Madina Musallah, Centurion Mall*
Zuhr 1:15
Asr 4:30 
Esha 7:15

*25.Madina Musallah, Forest Hill*
Zuhr 1:00
Asr 4:30

*26.Madressa Tul Owaisia 62 Saxby Rd*
Fajr 6:00
Zuhr 1:00
Asr 4:45
Esha 7:10

*27.Masjidus Salaam*
Fajr 5:35
Zuhr 12:45
Asr 4:45 
Esha 7:15

*28.Meelade Mustafa*
Fajr 5:45
Zuhr 12:45
Asr 4:30
Esha 7:15

*29.Metro Masjid Du Toit Str*
Fajr 6:00
Zuhr 12:45
Asr 4:15 
Esha 7:15

*30.Metro Montana*
Fajr 5:40 
Zohr 12:45
Asr 4:30 
Esha 7:30

*31.Mountain View Musallah*
Fajr 5:45 
Zohr 1:00
Asr 4:30
Esha 7:30

*32.Musallah@Communica 53 Landmarks Ave, Samrand*
Closed - Sunday

*33.Musallah Muaaz Bin Jabal RA (Sonneblom Street)*
Fajr 5:30
Zohr 1:00
Asr 4:45
Esha 7:05

*34.Mus'ab bin Umair RA Musallah (2nd Ave)* 
Fajr 5:30
Zohr 12:45
Asr 4:45
Esha 7:05

*35.Olievenhoutbosch Musallah*
Fajr 5:30
Zohr 1:00 
Asr 4:30
Esha 7:00

*36.Pretoria North Jamaat Khana*
*283 Danie Theron Street* 
Fajr 5:40
Zohr 1:00
Asr 5:00 
Esha 7:45

*37.Raslouw Hardware R55*
Fajr 5:30
Zohr 12:45
*Asr 4:30*
Esha 7:15

*38.Rasooli Centre Raslouw*
*Fajr 5:35*
Zohr 12:45
Asr 4:45
Esha 7:15

*39.Masjid Saabireen West Park*
Fajr 5:35
Zohr 12:45 
Asr 4:30 
Esha 7:15

*40.Sayyidina Ali RA*
Fajr 5:45
Zuhr 12:45 
Asr 4:30
Esha 7:15

*41.Senorita Street Musallah(438 Senorita Street, Erasmia)*
Fajr 5:30
Zohr 1:00
Asr 4:20
Esha 7:15

*42.Masjid Taqwa Lotus Gardens*
Fajr 5:35
Zuhr 1:15
Asr 4:45
Esha 7:15

*43.Masjid Uthmaan - Kit Kat*
Fajr 5:45
Zuhr 12:45
Asr 4:30 
Esha 7:30

*44.Valhalla Musallah (cnr Broadway East & Glufoss - next to Spar)*
Fajr 5:45
Zuhr 1:00
Asr 4:30 
Esha 7:15

Please correct or add if any.`

function facebookScraper(post) {

    const regex = /\*\d*\..*$/mg
    // const regex = /((\*\d*\..*$)|((Fajr)\s*(\d*\:\d*))|((Zuhr|Zohr)\s*(\d*\:\d*))|((Asr)\s*(\d*\:\d*))|((Esha)\s*(\d*\:\d*)))/gm

    const matchAll = post.matchAll(regex)
    let hasMatch = regex.test(post)

    let matchArray = []

    while (hasMatch) {
        let next = matchAll.next()
        if (!next.done) {
            matchArray.push(next.value)
        }
        hasMatch = !next.done
    }

    let masjidChunks = []

    matchArray.forEach((match, index) => {
        const masjid = match[0]
        const position = match.index
        const input = match.input

        nextIndex = index + 1 !== matchArray.length ? index + 1 : null

        if (nextIndex) {
            const nextPosition = matchArray[nextIndex].index
            masjidChunks.push(input.slice(position, nextPosition))
        } else {
            const endPosition = position + input.slice(position).match('\n\n').index
            masjidChunks.push(input.slice(position, endPosition))
        }
    })

    let masjidTimes = []
    const maghribTime = post.match(/(Maghrib.*)(\d+\:\d+)/)[2] + 'pm'

    masjidChunks.forEach(chunk => {
        chunk = chunk.replace(/\*/g, '')
        const key = 'PretoriaSalaahTimesFB-' + chunk.match(/\d+/)
        const title = chunk
            .slice(0, chunk.match('\n').index)
            .replace(/^\d+\./, '')

        const nameMatch = title.match(/\(/)
        const name = title.slice(0, nameMatch ? nameMatch.index : undefined)

        const addressMatch = title.match(/(\()(.+)(\))/)
        const address = addressMatch && addressMatch[2] ? addressMatch[2] : ''

        const fajrMatch = chunk.match(/(Fajr.*)(\d+\:\d+)/)
        const fajr = fajrMatch && fajrMatch[0]
            ? fajrMatch[0]
                .replace(' ', '')
                .replace('Fajr', '') + 'am'
            : ''

        const zuhrMatch = chunk.match(/((Zuhr|Zohr).*)(\d+\:\d+)/)
        const zuhr = zuhrMatch && zuhrMatch[0]
            ? zuhrMatch[0]
                .replace(' ', '')
                .replace('Zuhr', '')
                .replace('Zohr', '') + 'pm'
            : ''

        const asrMatch = chunk.match(/(Asr.*)(\d+\:\d+)/)
        const asr = asrMatch && asrMatch[0]
            ? asrMatch[0]
                .replace(' ', '')
                .replace('Asr', '') + 'pm'
            : ''

        const maghrib = maghribTime

        const eshaMatch = chunk.match(/(Esha.*)(\d+\:\d+)/)
        const esha = eshaMatch && eshaMatch[0]
            ? eshaMatch[0]
                .replace(' ', '')
                .replace('Esha', '') + 'pm'
            : ''

        const times = {
            key, title, name, address,
            location: 'Pretoria',
            fajrSalaah: fajr,
            zuhrSalaah: zuhr,
            asrSalaah: asr,
            maghribSalaah: maghrib,
            eshaSalaah: esha
        }

        masjidTimes.push(times)
    })

    return masjidTimes
}

module.exports = facebookScraper;